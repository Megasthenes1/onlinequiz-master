{% extends 'student/studentbase.html' %}
{% block content %}
{%load static%}

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <style>
    .card {
      background-color: #2d2d2d;
      border: 1px solid #3a3a3a;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      padding: 30px;
      margin: 20px;
    }
    
    h1 {
      color: #e0e0e0;
      text-align: center;
      margin-bottom: 30px;
    }
    
    h3 {
      color: #4a90e2;
      margin-top: 25px;
      margin-bottom: 15px;
    }
    
    h4 {
      color: #b0b0b0;
      text-align: right;
    }
    
    .form-check-label {
      color: #e0e0e0;
      margin-left: 10px;
    }
    
    .form-check-input {
      margin-top: 8px;
    }
    
    .form-check {
      margin: 15px 0;
      padding: 10px;
      background-color: #1a1a1a;
      border-radius: 5px;
      border: 1px solid #3a3a3a;
    }
    
    .form-check:hover {
      background-color: #252525;
      border-color: #4a90e2;
    }
    
    .btn-info {
      background-color: #4a90e2;
      border-color: #4a90e2;
      margin-top: 30px;
      padding: 12px 40px;
      font-size: 1.1rem;
    }
    
    .btn-info:hover {
      background-color: #357abd;
      border-color: #357abd;
    }
  </style>
</head>

<div class="container">
  <div class="card">
    <form class="form" autocomplete="off" onsubmit="return saveAns()" action="/student/calculate-marks" method="POST">
      {% csrf_token %}
      <h1>{{course.course_name}}</h1>
      {% for q in questions%}
      <h3>{{ forloop.counter }}. {{q.question}}</h3>
      <h4>[Marks {{q.marks}}]</h4>
      
      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option1}}" value="Option1">
        <label class="form-check-label" for="{{q.option1}}">
          {{q.option1}}
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option2}}" value="Option2">
        <label class="form-check-label" for="{{q.option2}}">
          {{q.option2}}
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option3}}" value="Option3">
        <label class="form-check-label" for="{{q.option3}}">
          {{q.option3}}
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="{{ forloop.counter }}" id="{{q.option4}}" value="Option4">
        <label class="form-check-label" for="{{q.option4}}">
          {{q.option4}}
        </label>
      </div>

      {% endfor %}
      <div style="text-align: center;">
        <input class="btn btn-info btn-lg" type="submit" value="Submit">
      </div>
    </form>
  </div>
</div>

<script> 
    // Get CSRF token from cookie
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }
    
    function saveAns(){  
        // Ensure CSRF token is in the form
        var form = document.querySelector('form.form');
        var csrfToken = getCookie('csrftoken');
        var csrfInput = form.querySelector('input[name="csrfmiddlewaretoken"]');
        
        if (!csrfInput && csrfToken) {
            // Add CSRF token if missing
            var hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'csrfmiddlewaretoken';
            hiddenInput.value = csrfToken;
            form.appendChild(hiddenInput);
        } else if (csrfInput && csrfToken && !csrfInput.value) {
            // Update CSRF token value if empty
            csrfInput.value = csrfToken;
        }
        
        // Save answers to cookies
        var ele = document.getElementsByTagName('input'); 
        for(i = 0; i < ele.length; i++) { 
            if(ele[i].type == "radio") { 
                if(ele[i].checked){        
                  setCookie(ele[i].name,ele[i].value,3)
                }
            } 
        } 
        return true; // Allow form submission
    }

</script> 

<br><br><br><br><br><br>
{% endblock content %}